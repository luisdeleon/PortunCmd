# Scope Visual Reference - All Scopes Explained

This document provides clear visual explanations of **ALL 4 scope types** in the PortunCmd system.

## ğŸ¯ Quick Overview: The 4 Scopes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PORTUNCMD SCOPES                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1ï¸âƒ£  GLOBAL SCOPE      â†’ Entire System (Super Admin)      â”‚
â”‚  2ï¸âƒ£  DEALER SCOPE      â†’ Dealer's Communities (Dealer)     â”‚
â”‚  3ï¸âƒ£  COMMUNITY SCOPE   â†’ Specific Communities (Admin/Guard)â”‚
â”‚  4ï¸âƒ£  PROPERTY SCOPE    â†’ Specific Properties (Resident)    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1ï¸âƒ£ GLOBAL SCOPE

### Who Uses It
- **Super Admin** role only

### Access Level
**UNLIMITED** - Can access everything in the entire system

### Visual Representation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ‘‘ SUPER ADMIN                            â”‚
â”‚                   (GLOBAL SCOPE)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Can access EVERYTHING â†“
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Community A   â”‚   â”‚  Community B    â”‚   â”‚  Community C   â”‚
â”‚  ğŸ¢ Sunset     â”‚   â”‚  ğŸ¢ Ocean View  â”‚   â”‚  ğŸ¢ Mountain   â”‚
â”‚    Gardens     â”‚   â”‚                 â”‚   â”‚    Estates     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”             â”Œâ”€â”€â”€â”´â”€â”€â”€â”             â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚       â”‚             â”‚       â”‚             â”‚       â”‚
  ğŸ Apt  ğŸ Apt         ğŸ Apt  ğŸ Apt         ğŸ Apt  ğŸ Apt
   101    102           201    202           301    302
    â”‚       â”‚             â”‚       â”‚             â”‚       â”‚
  ğŸ‘¤John ğŸ‘¤Mary        ğŸ‘¤Bob  ğŸ‘¤Sue         ğŸ‘¤Tom  ğŸ‘¤Ann

âœ… Can view/edit ALL communities
âœ… Can view/edit ALL properties
âœ… Can view/edit ALL users
âœ… Can configure system settings
âœ… Can create/delete communities
âœ… Can assign ALL roles
```

### Database Structure

```sql
-- profile_role record for Super Admin
{
  profile_id: 'super-admin-uuid',
  role_id: 'super-admin-role-id',
  scope_type: 'global',           â† Key field
  scope_dealer_id: NULL,          â† Not used
  scope_community_ids: NULL,      â† Not used
  scope_property_ids: NULL        â† Not used
}

-- No relationship tables needed
-- RLS policies check: scope_type = 'global' â†’ grant all access
```

### SQL Example

```sql
-- Assign global scope
INSERT INTO profile_role (
  profile_id,
  role_id,
  scope_type
) VALUES (
  'super-admin-uuid',
  (SELECT id FROM role WHERE role_name = 'Super Admin'),
  'global'  -- That's it! No other fields needed
);
```

### What They See

```
Dashboard:
  â”œâ”€â”€ All Communities: [Sunset Gardens, Ocean View, Mountain Estates, ...]
  â”œâ”€â”€ All Properties: [Apt 101, Apt 102, Apt 201, Apt 202, ...]
  â”œâ”€â”€ All Users: [John, Mary, Bob, Sue, Tom, Ann, ...]
  â”œâ”€â”€ System Settings âœ…
  â””â”€â”€ Full Access âœ…
```

---

## 2ï¸âƒ£ DEALER SCOPE

### Who Uses It
- **Dealer** role

### Access Level
**Multiple Communities** they manage + their administrators

### Visual Representation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸª DEALER                                 â”‚
â”‚            ABC Properties (DEALER SCOPE)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Can access their portfolio â†“
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Community A   â”‚   â”‚  Community B   â”‚   â”‚  Community C    â”‚
â”‚  ğŸ¢ Sunset     â”‚   â”‚  ğŸ¢ Ocean View â”‚   â”‚ ğŸ¢ Mountain     â”‚
â”‚    Gardens     â”‚   â”‚                â”‚   â”‚   Estates       â”‚
â”‚                â”‚   â”‚                â”‚   â”‚                 â”‚
â”‚  ğŸ‘¨â€ğŸ’¼ Jane      â”‚   â”‚  ğŸ‘¨â€ğŸ’¼ Bob       â”‚   â”‚ âŒ NOT OWNED   â”‚
â”‚  (Admin)       â”‚   â”‚  (Admin)       â”‚   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
    âœ… Can access        âœ… Can access      âŒ No access
       via Admin            via Admin          (other dealer)
```

### Scope Hierarchy

```
Dealer: ABC Properties
  â”‚
  â”œâ”€â”€â”€ Manages Community A (via Administrator Jane)
  â”‚     â””â”€â”€â”€ Community A contains:
  â”‚           â”œâ”€â”€ Apt 101, 102, 103...
  â”‚           â””â”€â”€ Residents: John, Mary, Bob...
  â”‚
  â”œâ”€â”€â”€ Manages Community B (via Administrator Bob)
  â”‚     â””â”€â”€â”€ Community B contains:
  â”‚           â”œâ”€â”€ Apt 201, 202, 203...
  â”‚           â””â”€â”€ Residents: Sue, Tom, Ann...
  â”‚
  â””â”€â”€â”€ âŒ Does NOT manage Community C (different dealer)
```

### Database Structure

```sql
-- Step 1: profile_role record for Dealer
{
  profile_id: 'dealer-uuid',
  role_id: 'dealer-role-id',
  scope_type: 'dealer',            â† Key field
  scope_dealer_id: 'dealer-uuid',  â† Self-reference!
  scope_community_ids: NULL,       â† Not directly stored (see below)
  scope_property_ids: NULL         â† Not used
}

-- Step 2: dealer_administrators table (defines which communities)
{
  dealer_id: 'dealer-uuid',
  administrator_id: 'jane-uuid',
  assigned_community_ids: ['sunset-gardens', 'ocean-view']  â† Communities!
}
{
  dealer_id: 'dealer-uuid',
  administrator_id: 'bob-uuid',
  assigned_community_ids: ['mountain-estates']
}

-- Communities are derived from dealer_administrators table
-- RLS policies check: "Is this community in ANY of dealer's administrator assignments?"
```

### SQL Example

```sql
-- Complete dealer setup
BEGIN;

-- Step 1: Assign Dealer role
INSERT INTO profile_role (
  profile_id,
  role_id,
  scope_type,
  scope_dealer_id
) VALUES (
  'dealer-uuid',
  (SELECT id FROM role WHERE role_name = 'Dealer'),
  'dealer',
  'dealer-uuid'  -- Self-reference
);

-- Step 2: Create administrators under this dealer
INSERT INTO dealer_administrators (
  dealer_id,
  administrator_id,
  assigned_community_ids
) VALUES
  ('dealer-uuid', 'jane-uuid', ARRAY['sunset-gardens', 'ocean-view']),
  ('dealer-uuid', 'bob-uuid', ARRAY['mountain-estates']);

COMMIT;

-- Now dealer can access Sunset Gardens, Ocean View, and Mountain Estates
```

### What They See

```
Dashboard:
  â”œâ”€â”€ My Communities: [Sunset Gardens, Ocean View, Mountain Estates]
  â”‚     (via their administrators)
  â”‚
  â”œâ”€â”€ My Administrators: [Jane (2 communities), Bob (1 community)]
  â”‚
  â”œâ”€â”€ Properties in my communities: [All properties in those 3 communities]
  â”‚
  â”œâ”€â”€ Residents in my communities: [All residents in those 3 communities]
  â”‚
  â”œâ”€â”€ âŒ Community D (owned by different dealer) - No access
  â”‚
  â””â”€â”€ âŒ System Settings - No access
```

### Access Pattern

```
Query: "Show me all communities"

RLS Policy checks:
  â”Œâ”€ Is user Super Admin (global)? â†’ No
  â”œâ”€ Is user Dealer? â†’ Yes
  â”‚   â””â”€ Get communities from dealer_administrators
  â”‚       WHERE dealer_id = current_user
  â”‚       â†’ Returns: [sunset-gardens, ocean-view, mountain-estates]
  â””â”€ Filter communities WHERE id IN (those 3)

Result: User sees only their 3 communities âœ…
```

---

## 3ï¸âƒ£ COMMUNITY SCOPE

### Who Uses It
- **Administrator** role (full management)
- **Guard** role (view + gate control)

### Access Level
**Specific communities** only (can be 1 or multiple)

### Visual Representation

#### Administrator with Single Community

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ‘¨â€ğŸ’¼ ADMINISTRATOR: Jane                          â”‚
â”‚          (COMMUNITY SCOPE: [sunset-gardens])                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Can manage this community â†“
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ğŸ¢ Sunset        â”‚
                    â”‚     Gardens        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
    â”Œâ”€â”€â”€â–¼â”€â”€â”€â”             â”Œâ”€â”€â”€â–¼â”€â”€â”€â”            â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
    â”‚ ğŸ  Aptâ”‚             â”‚ ğŸ  Aptâ”‚            â”‚ ğŸ  Aptâ”‚
    â”‚  101  â”‚             â”‚  102  â”‚            â”‚  103  â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”˜             â””â”€â”€â”€â”¬â”€â”€â”€â”˜            â””â”€â”€â”€â”¬â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
      ğŸ‘¤John                ğŸ‘¤Mary                 ğŸ‘¤Bob
        â”‚                     â”‚                     â”‚
    âœ… Can manage         âœ… Can manage          âœ… Can manage

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ¢ Ocean View (Different Community)                        â”‚
â”‚   âŒ NO ACCESS - Not in scope                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Administrator with Multiple Communities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ‘¨â€ğŸ’¼ ADMINISTRATOR: Sarah                         â”‚
â”‚   (COMMUNITY SCOPE: [sunset-gardens, ocean-view])            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¢ Sunset     â”‚                         â”‚  ğŸ¢ Ocean View  â”‚
â”‚    Gardens     â”‚                         â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                           â”‚
    âœ… Can manage                              âœ… Can manage
    All properties                             All properties
    All residents                              All residents

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ¢ Mountain Estates (Different Community)                  â”‚
â”‚   âŒ NO ACCESS - Not in scope                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Guard with Community Scope

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ğŸ’‚ GUARD: Mike                                â”‚
â”‚          (COMMUNITY SCOPE: [sunset-gardens])                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Can monitor this community â†“
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ğŸ¢ Sunset        â”‚
                    â”‚     Gardens        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
    Properties            Residents              Gates
        â”‚                     â”‚                     â”‚
    ğŸ‘€ View only          ğŸ‘€ View only          ğŸ›ï¸ Control
    (Read-only)           (Read-only)          (Can open/close)
        â”‚                     â”‚                     â”‚
    âŒ Can't create       âŒ Can't create       âœ… Can control
    âŒ Can't edit         âŒ Can't edit            automation
    âŒ Can't delete       âŒ Can't delete

    ğŸ‘ï¸ Visitors                                ğŸš¨ Alerts
        â”‚                                           â”‚
    âœ… Can view                                 âœ… Can view
    âœ… Can update status                        âœ… Can respond
    (Check in/out)
```

### Database Structure

```sql
-- Administrator with single community
{
  profile_id: 'admin-uuid',
  role_id: 'admin-role-id',
  scope_type: 'community',              â† Key field
  scope_dealer_id: NULL,
  scope_community_ids: ['sunset-gardens'],  â† Array with 1 community
  scope_property_ids: NULL
}

-- Link to community
community_manager {
  profile_id: 'admin-uuid',
  community_id: 'sunset-gardens',
  property_id: NULL  -- NULL = manages entire community
}

-- Administrator with multiple communities
{
  profile_id: 'admin2-uuid',
  role_id: 'admin-role-id',
  scope_type: 'community',
  scope_dealer_id: NULL,
  scope_community_ids: ['sunset-gardens', 'ocean-view', 'mountain-estates'],  â† Multiple!
  scope_property_ids: NULL
}

-- Link to each community
community_manager records:
  { profile_id: 'admin2-uuid', community_id: 'sunset-gardens', property_id: NULL }
  { profile_id: 'admin2-uuid', community_id: 'ocean-view', property_id: NULL }
  { profile_id: 'admin2-uuid', community_id: 'mountain-estates', property_id: NULL }
```

### SQL Examples

#### Single Community Administrator

```sql
BEGIN;

-- Step 1: Assign Administrator role
INSERT INTO profile_role (
  profile_id,
  role_id,
  scope_type,
  scope_community_ids
) VALUES (
  'admin-uuid',
  (SELECT id FROM role WHERE role_name = 'Administrator'),
  'community',
  ARRAY['sunset-gardens']  -- Single community in array
);

-- Step 2: Link to community
INSERT INTO community_manager (
  profile_id,
  community_id,
  property_id
) VALUES (
  'admin-uuid',
  'sunset-gardens',
  NULL
);

COMMIT;
```

#### Multiple Community Administrator

```sql
BEGIN;

-- Step 1: Assign Administrator role with multiple communities
INSERT INTO profile_role (
  profile_id,
  role_id,
  scope_type,
  scope_community_ids
) VALUES (
  'admin-uuid',
  (SELECT id FROM role WHERE role_name = 'Administrator'),
  'community',
  ARRAY['sunset-gardens', 'ocean-view', 'mountain-estates']  -- Multiple!
);

-- Step 2: Link to each community (bulk insert)
INSERT INTO community_manager (profile_id, community_id, property_id)
SELECT
  'admin-uuid',
  unnest(ARRAY['sunset-gardens', 'ocean-view', 'mountain-estates']),
  NULL;

COMMIT;
```

#### Guard

```sql
BEGIN;

INSERT INTO profile_role (
  profile_id,
  role_id,
  scope_type,
  scope_community_ids
) VALUES (
  'guard-uuid',
  (SELECT id FROM role WHERE role_name = 'Guard'),
  'community',
  ARRAY['sunset-gardens']
);

INSERT INTO community_manager (profile_id, community_id, property_id)
VALUES ('guard-uuid', 'sunset-gardens', NULL);

COMMIT;
```

### What They See

#### Administrator Dashboard

```
Dashboard:
  â”œâ”€â”€ My Communities: [Sunset Gardens] (or multiple if assigned)
  â”‚
  â”œâ”€â”€ Properties in Sunset Gardens: [Apt 101, 102, 103, ...]
  â”‚     â””â”€â”€ âœ… Can create new properties
  â”‚     â””â”€â”€ âœ… Can edit property details
  â”‚     â””â”€â”€ âœ… Can delete properties
  â”‚
  â”œâ”€â”€ Residents in Sunset Gardens: [John, Mary, Bob, ...]
  â”‚     â””â”€â”€ âœ… Can add new residents
  â”‚     â””â”€â”€ âœ… Can edit resident info
  â”‚     â””â”€â”€ âœ… Can remove residents
  â”‚
  â”œâ”€â”€ Visitors in Sunset Gardens: [All visitor records]
  â”‚     â””â”€â”€ âœ… Can view all
  â”‚     â””â”€â”€ âœ… Can approve/deny
  â”‚
  â”œâ”€â”€ Automation: [Gates, devices in Sunset Gardens]
  â”‚     â””â”€â”€ âœ… Can configure
  â”‚     â””â”€â”€ âœ… Can control
  â”‚
  â””â”€â”€ âŒ Ocean View, Mountain Estates - No access (different communities)
```

#### Guard Dashboard

```
Dashboard:
  â”œâ”€â”€ My Community: [Sunset Gardens]
  â”‚
  â”œâ”€â”€ Properties: [View only - Apt 101, 102, 103, ...]
  â”‚     â””â”€â”€ ğŸ‘€ View details
  â”‚     â””â”€â”€ âŒ Cannot create/edit/delete
  â”‚
  â”œâ”€â”€ Residents: [View only - John, Mary, Bob, ...]
  â”‚     â””â”€â”€ ğŸ‘€ View contact info
  â”‚     â””â”€â”€ âŒ Cannot create/edit/delete
  â”‚
  â”œâ”€â”€ Visitors: [Can view and manage]
  â”‚     â””â”€â”€ âœ… View visitor passes
  â”‚     â””â”€â”€ âœ… Check in/out visitors
  â”‚     â””â”€â”€ âœ… Update visitor status
  â”‚
  â”œâ”€â”€ Gate Control: [Active controls]
  â”‚     â””â”€â”€ âœ… Open/close gates
  â”‚     â””â”€â”€ âœ… View access logs
  â”‚
  â””â”€â”€ âŒ Other communities - No access
```

### Access Pattern

```
Query: "Show me all properties"

RLS Policy checks:
  â”Œâ”€ Is user Super Admin (global)? â†’ No
  â”œâ”€ Is user Administrator/Guard? â†’ Yes
  â”‚   â””â”€ Get their scope_community_ids
  â”‚       â†’ Returns: ['sunset-gardens']
  â”‚   â””â”€ Filter properties WHERE community_id IN ('sunset-gardens')
  â””â”€ Return only properties in Sunset Gardens

Result: User sees only properties in their assigned community/communities âœ…
```

---

## 4ï¸âƒ£ PROPERTY SCOPE

### Who Uses It
- **Resident** role

### Access Level
**Specific properties** only (usually 1, can be multiple if they own multiple units)

### Visual Representation

#### Resident with Single Property

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ğŸ  RESIDENT: John                             â”‚
â”‚            (PROPERTY SCOPE: [apt-101])                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Can access only their property â†“
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   ğŸ  Apartment 101 â”‚
                    â”‚   Sunset Gardens   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
    ğŸ« Visitors           ğŸ“‹ Property            ğŸ˜ï¸ Community
        â”‚                  Details                  Info
        â”‚                     â”‚                     â”‚
    âœ… Create passes      ğŸ‘€ View details       ğŸ‘€ View name,
    âœ… View history       âœ… Edit notes            address
    âœ… Manage guests      âŒ Can't edit           (context only)
                             core info

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Other Properties in Community                              â”‚
â”‚   ğŸ  Apt 102, 103, 104... âŒ NO ACCESS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Resident with Multiple Properties

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ğŸ  RESIDENT: Mary                             â”‚
â”‚         (PROPERTY SCOPE: [apt-101, apt-201])                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  Apartment   â”‚                         â”‚ ğŸ  Apartment    â”‚
â”‚     101        â”‚                         â”‚     201         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                           â”‚
    âœ… Full access                              âœ… Full access
    Create visitors                             Create visitors
    View details                                View details

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ  Apt 102, 103, 202... âŒ NO ACCESS                       â”‚
â”‚   (Other residents' properties)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Co-Ownership Scenario

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ğŸ  Apartment 101                              â”‚
â”‚            (Multiple Owners/Residents)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resident:      â”‚   â”‚ Resident:       â”‚   â”‚ Resident:      â”‚
â”‚ John           â”‚   â”‚ Jane (spouse)   â”‚   â”‚ Bob (tenant)   â”‚
â”‚ (Owner)        â”‚   â”‚ (Co-owner)      â”‚   â”‚ (Renter)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
All have scope_property_ids = ['apt-101']
All can create visitors for Apt 101
All see same property data
```

### Database Structure

```sql
-- Resident with single property
{
  profile_id: 'resident-uuid',
  role_id: 'resident-role-id',
  scope_type: 'property',          â† Key field
  scope_dealer_id: NULL,
  scope_community_ids: NULL,
  scope_property_ids: ['apt-101']  â† Single property in array
}

-- Link to property
property_owner {
  profile_id: 'resident-uuid',
  property_id: 'apt-101',
  community_id: 'sunset-gardens'
}

-- Resident with multiple properties
{
  profile_id: 'resident2-uuid',
  role_id: 'resident-role-id',
  scope_type: 'property',
  scope_dealer_id: NULL,
  scope_community_ids: NULL,
  scope_property_ids: ['apt-101', 'apt-201', 'parking-space-12']  â† Multiple!
}

-- Link to each property
property_owner records:
  { profile_id: 'resident2-uuid', property_id: 'apt-101', community_id: 'sunset-gardens' }
  { profile_id: 'resident2-uuid', property_id: 'apt-201', community_id: 'sunset-gardens' }
  { profile_id: 'resident2-uuid', property_id: 'parking-space-12', community_id: 'sunset-gardens' }
```

### SQL Examples

#### Single Property Resident

```sql
BEGIN;

-- Step 1: Assign Resident role
INSERT INTO profile_role (
  profile_id,
  role_id,
  scope_type,
  scope_property_ids
) VALUES (
  'resident-uuid',
  (SELECT id FROM role WHERE role_name = 'Resident'),
  'property',
  ARRAY['apt-101']  -- Single property
);

-- Step 2: Link to property
INSERT INTO property_owner (
  profile_id,
  property_id,
  community_id
) VALUES (
  'resident-uuid',
  'apt-101',
  'sunset-gardens'
);

-- Step 3: Set defaults (optional but recommended)
UPDATE profile
SET
  def_community_id = 'sunset-gardens',
  def_property_id = 'apt-101'
WHERE id = 'resident-uuid';

COMMIT;
```

#### Multiple Property Resident

```sql
BEGIN;

-- Step 1: Assign Resident role with multiple properties
INSERT INTO profile_role (
  profile_id,
  role_id,
  scope_type,
  scope_property_ids
) VALUES (
  'resident-uuid',
  (SELECT id FROM role WHERE role_name = 'Resident'),
  'property',
  ARRAY['apt-101', 'apt-201', 'parking-12']  -- Multiple properties
);

-- Step 2: Link to each property
INSERT INTO property_owner (profile_id, property_id, community_id)
VALUES
  ('resident-uuid', 'apt-101', 'sunset-gardens'),
  ('resident-uuid', 'apt-201', 'sunset-gardens'),
  ('resident-uuid', 'parking-12', 'sunset-gardens');

-- Step 3: Set primary property as default
UPDATE profile
SET
  def_community_id = 'sunset-gardens',
  def_property_id = 'apt-101'  -- Primary residence
WHERE id = 'resident-uuid';

COMMIT;
```

### What They See

#### Single Property Resident Dashboard

```
Dashboard:
  â”œâ”€â”€ My Property: Apartment 101
  â”‚     â””â”€â”€ ğŸ  View address, details
  â”‚     â””â”€â”€ ğŸ‘€ View community info (Sunset Gardens)
  â”‚     â””â”€â”€ âŒ Cannot edit property details
  â”‚
  â”œâ”€â”€ My Visitors: [All visitor passes for Apt 101]
  â”‚     â””â”€â”€ âœ… Create new visitor pass
  â”‚     â””â”€â”€ âœ… Generate QR code
  â”‚     â””â”€â”€ âœ… View visitor history
  â”‚     â””â”€â”€ âœ… Cancel/edit passes
  â”‚
  â”œâ”€â”€ Visitor Logs: [Entry/exit history for Apt 101]
  â”‚     â””â”€â”€ ğŸ‘€ View who visited
  â”‚     â””â”€â”€ ğŸ‘€ View timestamps
  â”‚
  â”œâ”€â”€ Community Announcements: [Read-only]
  â”‚     â””â”€â”€ ğŸ‘€ View messages from admin
  â”‚
  â””â”€â”€ âŒ Other properties (102, 103...) - No access
  â””â”€â”€ âŒ Other residents - No access
  â””â”€â”€ âŒ Community management - No access
```

#### Multiple Property Resident Dashboard

```
Dashboard:
  â”œâ”€â”€ My Properties: [3 properties]
  â”‚     â”œâ”€â”€ ğŸ  Apartment 101 (primary)
  â”‚     â”œâ”€â”€ ğŸ  Apartment 201
  â”‚     â””â”€â”€ ğŸ…¿ï¸ Parking Space 12
  â”‚
  â”œâ”€â”€ Visitors for Apt 101: [...]
  â”‚     â””â”€â”€ âœ… Create/manage
  â”‚
  â”œâ”€â”€ Visitors for Apt 201: [...]
  â”‚     â””â”€â”€ âœ… Create/manage
  â”‚
  â”œâ”€â”€ Parking access for Space 12: [...]
  â”‚     â””â”€â”€ âœ… Manage vehicle access
  â”‚
  â””â”€â”€ âŒ Other properties - No access
```

### Access Pattern

```
Query: "Show me all visitor records"

RLS Policy checks:
  â”Œâ”€ Is user Super Admin (global)? â†’ No
  â”œâ”€ Is user Resident? â†’ Yes
  â”‚   â””â”€ Get their scope_property_ids
  â”‚       â†’ Returns: ['apt-101']
  â”‚   â””â”€ Filter visitor_records WHERE property_id IN ('apt-101')
  â”‚       OR host_uid = current_user (they created it)
  â””â”€ Return only visitors for their property

Result: User sees only visitors for Apt 101 âœ…
```

### Resident Limitations

```
âœ… CAN DO:
  â”œâ”€â”€ View their own property details
  â”œâ”€â”€ Create visitor passes for their property
  â”œâ”€â”€ View visitor history for their property
  â”œâ”€â”€ Receive community announcements
  â””â”€â”€ View community contact info (context)

âŒ CANNOT DO:
  â”œâ”€â”€ View other properties
  â”œâ”€â”€ View other residents' info
  â”œâ”€â”€ Create/edit/delete properties
  â”œâ”€â”€ Manage other residents
  â”œâ”€â”€ Access community management functions
  â”œâ”€â”€ Configure automation
  â””â”€â”€ View system-wide reports
```

---

## ğŸ”„ Scope Hierarchy & Inheritance

### The Scope Pyramid

```
                    ğŸ‘‘
                 GLOBAL
              (Everything)
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
      ğŸª DEALER              (Inherits)
    (Their Portfolio)           â”‚
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
              ğŸ¢ COMMUNITY
           (Specific Communities)
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
   (Inherits)              (Inherits)
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
              ğŸ  PROPERTY
          (Specific Properties)
                    â”‚
                (Narrowest)
```

### Access Cascade

```
If you have GLOBAL scope:
  â””â”€ You can access everything at ALL lower levels
      â”œâ”€ All dealer operations
      â”œâ”€ All community operations
      â””â”€ All property operations

If you have DEALER scope:
  â””â”€ You can access your communities and their properties
      â”œâ”€ Your communities only
      â””â”€ Properties in your communities only
      âŒ NOT other dealers' communities

If you have COMMUNITY scope:
  â””â”€ You can access assigned communities and their properties
      â”œâ”€ Assigned communities only
      â””â”€ Properties in those communities only
      âŒ NOT other communities

If you have PROPERTY scope:
  â””â”€ You can access ONLY your specific properties
      â”œâ”€ Your properties only
      â””â”€ Community info (context only)
      âŒ NOT other properties
      âŒ NOT community management
```

---

## ğŸ“Š Scope Comparison Table

| Feature | Global | Dealer | Community | Property |
|---------|--------|--------|-----------|----------|
| **Database Field** | `scope_type = 'global'` | `scope_dealer_id` | `scope_community_ids[]` | `scope_property_ids[]` |
| **Relationship Table** | None | `dealer_administrators` | `community_manager` | `property_owner` |
| **Can See Communities** | All | Their portfolio | Assigned only | Context only |
| **Can See Properties** | All | In their communities | In assigned communities | Their own only |
| **Can See All Residents** | Yes | In their communities | In assigned communities | No |
| **Can Manage Communities** | Yes | Via admins | Assigned only | No |
| **Can Create Properties** | Yes | Via admins | In assigned communities | No |
| **Can Create Residents** | Yes | Via admins | In assigned communities | No |
| **Can Create Visitors** | Yes | Yes | In assigned communities | For own properties |
| **Can Configure System** | Yes | No | No | No |
| **Typical Use Case** | System owner | Property management company | Community admin/guard | Property owner/tenant |

---

## ğŸ¯ Scope Quick Reference

### When to Use Each Scope

```
Use GLOBAL when:
  â””â”€ User needs unrestricted system access (system owner/tech admin)

Use DEALER when:
  â””â”€ User manages multiple communities (property management company)

Use COMMUNITY when:
  â””â”€ User manages specific community/communities (on-site admin or guard)

Use PROPERTY when:
  â””â”€ User owns/rents specific property/properties (resident)
```

### Scope Assignment Checklist

```
Assigning GLOBAL scope:
  â˜ Create profile_role with scope_type = 'global'
  â˜ No relationship table needed
  â˜ No scope_*_ids needed
  â˜ Done!

Assigning DEALER scope:
  â˜ Create profile_role with scope_type = 'dealer'
  â˜ Set scope_dealer_id = user's own UUID
  â˜ Create dealer_administrators records linking to their admins
  â˜ Set assigned_community_ids in dealer_administrators
  â˜ Done!

Assigning COMMUNITY scope:
  â˜ Create profile_role with scope_type = 'community'
  â˜ Set scope_community_ids = array of community IDs
  â˜ Create community_manager record(s)
  â˜ Link to each community
  â˜ Done!

Assigning PROPERTY scope:
  â˜ Create profile_role with scope_type = 'property'
  â˜ Set scope_property_ids = array of property IDs
  â˜ Create property_owner record(s)
  â˜ Link to each property
  â˜ Set def_property_id in profile (recommended)
  â˜ Done!
```

---

## ğŸ” Scope Troubleshooting

### Problem: User can't see expected data

```
Diagnosis Steps:
  1. Check scope_type is correct
     â””â”€ SELECT scope_type FROM profile_role WHERE profile_id = 'user-uuid'

  2. Check scope fields are populated
     â””â”€ Global: No fields needed
     â””â”€ Dealer: scope_dealer_id should = user's UUID
     â””â”€ Community: scope_community_ids should be array with IDs
     â””â”€ Property: scope_property_ids should be array with IDs

  3. Check relationship tables
     â””â”€ Dealer: dealer_administrators should exist
     â””â”€ Community: community_manager should exist
     â””â”€ Property: property_owner should exist

  4. Check RLS policies
     â””â”€ Verify policies exist for this table
     â””â”€ Verify policies check scope correctly
```

### Problem: Scope too broad

```
Solution:
  1. Review scope_*_ids arrays
  2. Remove unnecessary community/property IDs
  3. Update relationship tables to match
  4. Consider splitting into multiple users if needed
```

### Problem: Scope too narrow

```
Solution:
  1. Add additional IDs to scope_*_ids arrays
  2. Create corresponding relationship records
  3. Verify user can now access expected data
```

---

## ğŸ“š Complete Scope Documentation

For more details, see:
- **[Scope System Guide](./SCOPE_SYSTEM_GUIDE.md)** - Complete technical reference
- **[Community-User-Property Guide](./COMMUNITY_USER_PROPERTY_GUIDE.md)** - How entities relate
- **[Data Model Workflows](./DATA_MODEL_WORKFLOWS.md)** - Practical SQL examples
- **[RBAC Guide](./RBAC_GUIDE.md)** - Role-based permissions

---

**You now understand ALL 4 scopes in the PortunCmd system!** ğŸ‰

| Scope | Who | Access |
|-------|-----|--------|
| 1ï¸âƒ£ Global | Super Admin | Everything |
| 2ï¸âƒ£ Dealer | Dealer | Their communities |
| 3ï¸âƒ£ Community | Admin/Guard | Specific communities |
| 4ï¸âƒ£ Property | Resident | Their properties |
